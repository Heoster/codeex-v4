{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the CODEEX AI application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "googleId": {
          "type": "string",
          "description": "User ID from Google authentication, if the user signed up with Google."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "Display name of the user."
        },
        "creationTimestamp": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        },
        "lastLoginTimestamp": {
          "type": "string",
          "description": "Timestamp indicating the last time the user logged in.",
          "format": "date-time"
        },
        "profilePictureUrl": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        }
      },
      "required": [
        "id"
      ]
    },
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatMessage",
      "type": "object",
      "description": "Represents a single message within a chat conversation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ChatMessage entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N ChatMessage).  The user who sent the message."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp indicating when the message was sent.",
          "format": "date-time"
        },
        "content": {
          "type": "string",
          "description": "The content of the chat message."
        },
        "isUserGenerated": {
          "type": "boolean",
          "description": "Indicates if the message was generated by the user (true) or the AI (false)."
        }
      },
      "required": [
        "id",
        "userId",
        "timestamp",
        "content",
        "isUserGenerated"
      ]
    },
    "ConversationHistory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ConversationHistory",
      "type": "object",
      "description": "Represents the stored history for a user's conversation with the AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ConversationHistory entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N ConversationHistory)"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of the start of the conversation or session.",
          "format": "date-time"
        },
        "chatMessageIds": {
          "type": "array",
          "description": "References to ChatMessages. (Relationship: ConversationHistory 1:N ChatMessage)",
          "items": {
            "type": "string"
          }
        },
        "summary": {
          "type": "string",
          "description": "A summary of the conversation."
        }
      },
      "required": [
        "id",
        "userId",
        "timestamp",
        "chatMessageIds"
      ]
    },
    "LearningPath": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LearningPath",
      "type": "object",
      "description": "Represents a personalized learning path for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the LearningPath entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N LearningPath)"
        },
        "name": {
          "type": "string",
          "description": "The name of the learning path."
        },
        "description": {
          "type": "string",
          "description": "A description of the learning path."
        },
        "moduleIds": {
          "type": "array",
          "description": "References to LearningModules. (Relationship: LearningPath 1:N LearningModule)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "name"
      ]
    },
    "LearningModule": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LearningModule",
      "type": "object",
      "description": "Represents a single module within a learning path.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the LearningModule entity."
        },
        "learningPathId": {
          "type": "string",
          "description": "Reference to LearningPath. (Relationship: LearningPath 1:N LearningModule)"
        },
        "name": {
          "type": "string",
          "description": "The name of the learning module."
        },
        "content": {
          "type": "string",
          "description": "The content of the learning module (e.g., text, links, videos)."
        },
        "quizId": {
          "type": "string",
          "description": "Reference to Quiz. (Relationship: LearningModule 1:1 Quiz)"
        }
      },
      "required": [
        "id",
        "learningPathId",
        "name",
        "content"
      ]
    },
    "Quiz": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Quiz",
      "type": "object",
      "description": "Represents a quiz associated with a learning module.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Quiz entity."
        },
        "learningModuleId": {
          "type": "string",
          "description": "Reference to LearningModule. (Relationship: LearningModule 1:1 Quiz)"
        },
        "questionIds": {
          "type": "array",
          "description": "References to Questions. (Relationship: Quiz 1:N Question)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "learningModuleId"
      ]
    },
    "Question": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Question",
      "type": "object",
      "description": "Represents a single question within a quiz.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Question entity."
        },
        "quizId": {
          "type": "string",
          "description": "Reference to Quiz. (Relationship: Quiz 1:N Question)"
        },
        "text": {
          "type": "string",
          "description": "The text of the question."
        },
        "answerIds": {
          "type": "array",
          "description": "References to Answers. (Relationship: Question 1:N Answer)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "quizId",
        "text"
      ]
    },
    "Answer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Answer",
      "type": "object",
      "description": "Represents a possible answer to a quiz question.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Answer entity."
        },
        "questionId": {
          "type": "string",
          "description": "Reference to Question. (Relationship: Question 1:N Answer)"
        },
        "text": {
          "type": "string",
          "description": "The text of the answer."
        },
        "isCorrect": {
          "type": "boolean",
          "description": "Indicates if this answer is the correct answer to the question."
        }
      },
      "required": [
        "id",
        "questionId",
        "text",
        "isCorrect"
      ]
    },
    "UserSetting": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserSetting",
      "type": "object",
      "description": "Represents a user-specific app setting.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserSetting entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N UserSetting)"
        },
        "settingKey": {
          "type": "string",
          "description": "The key for the user setting (e.g., 'darkMode', 'fontSize')."
        },
        "settingValue": {
          "type": "string",
          "description": "The value of the user setting (e.g., 'true', '16'). Stored as a string to accommodate different data types."
        }
      },
      "required": [
        "id",
        "userId",
        "settingKey",
        "settingValue"
      ]
    },
    "ResponseRating": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ResponseRating",
      "type": "object",
      "description": "Represents a user's rating of an AI response.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ResponseRating entity."
        },
        "chatMessageId": {
          "type": "string",
          "description": "Reference to ChatMessage. (Relationship: ChatMessage 1:1 ResponseRating). The AI response that was rated."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N ResponseRating). The user who gave the rating."
        },
        "rating": {
          "type": "number",
          "description": "The rating given by the user (e.g., a star rating from 1 to 5).",
          "format": "number"
        },
        "feedback": {
          "type": "string",
          "description": "Optional text feedback provided by the user."
        }
      },
      "required": [
        "id",
        "chatMessageId",
        "userId",
        "rating"
      ]
    },
    "PromptHistory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PromptHistory",
      "type": "object",
      "description": "Represents a user's history of prompts entered.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the PromptHistory entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N PromptHistory)"
        },
        "promptText": {
          "type": "string",
          "description": "The text of the prompt."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp indicating when the prompt was entered.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "promptText",
        "timestamp"
      ]
    },
    "Plugin": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Plugin",
      "type": "object",
      "description": "Represents a user-installed plugin for extending the AI's functionality.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Plugin entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Plugin).  The user who installed the plugin."
        },
        "name": {
          "type": "string",
          "description": "The name of the plugin."
        },
        "description": {
          "type": "string",
          "description": "A description of the plugin's functionality."
        },
        "config": {
          "type": "string",
          "description": "Configuration settings for the plugin (stored as a JSON string)."
        },
        "enabled": {
          "type": "boolean",
          "description": "Indicates if the plugin is currently enabled."
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "description",
        "config",
        "enabled"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information.  Path-based ownership ensures only the user can access their own data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/chat_messages/{chatMessageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores chat messages for a specific user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "chatMessageId",
              "description": "The unique identifier for the chat message."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/conversation_history/{conversationHistoryId}",
        "definition": {
          "entityName": "ConversationHistory",
          "schema": {
            "$ref": "#/backend/entities/ConversationHistory"
          },
          "description": "Stores conversation history for a specific user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "conversationHistoryId",
              "description": "The unique identifier for the conversation history."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/learning_paths/{learningPathId}",
        "definition": {
          "entityName": "LearningPath",
          "schema": {
            "$ref": "#/backend/entities/LearningPath"
          },
          "description": "Stores learning paths for a specific user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "learningPathId",
              "description": "The unique identifier for the learning path."
            }
          ]
        }
      },
      {
        "path": "/learning_modules/{learningModuleId}",
        "definition": {
          "entityName": "LearningModule",
          "schema": {
            "$ref": "#/backend/entities/LearningModule"
          },
          "description": "Stores learning modules. While not directly tied to a user, if access control is needed, consider adding a 'members' map or linking to a user's learning path.",
          "params": [
            {
              "name": "learningModuleId",
              "description": "The unique identifier for the learning module."
            }
          ]
        }
      },
      {
        "path": "/quizzes/{quizId}",
        "definition": {
          "entityName": "Quiz",
          "schema": {
            "$ref": "#/backend/entities/Quiz"
          },
          "description": "Stores quizzes. If quizzes are user-specific, consider nesting them under /users/{userId}/quizzes/{quizId}.",
          "params": [
            {
              "name": "quizId",
              "description": "The unique identifier for the quiz."
            }
          ]
        }
      },
      {
        "path": "/questions/{questionId}",
        "definition": {
          "entityName": "Question",
          "schema": {
            "$ref": "#/backend/entities/Question"
          },
          "description": "Stores questions. Questions are associated with quizzes.",
          "params": [
            {
              "name": "questionId",
              "description": "The unique identifier for the question."
            }
          ]
        }
      },
      {
        "path": "/answers/{answerId}",
        "definition": {
          "entityName": "Answer",
          "schema": {
            "$ref": "#/backend/entities/Answer"
          },
          "description": "Stores answers to quiz questions.",
          "params": [
            {
              "name": "answerId",
              "description": "The unique identifier for the answer."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/settings/{settingId}",
        "definition": {
          "entityName": "UserSetting",
          "schema": {
            "$ref": "#/backend/entities/UserSetting"
          },
          "description": "Stores user-specific settings. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "settingId",
              "description": "The unique identifier for the user setting."
            }
          ]
        }
      },
      {
        "path": "/response_ratings/{responseRatingId}",
        "definition": {
          "entityName": "ResponseRating",
          "schema": {
            "$ref": "#/backend/entities/ResponseRating"
          },
          "description": "Stores user ratings for AI responses.",
          "params": [
            {
              "name": "responseRatingId",
              "description": "The unique identifier for the response rating."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/prompt_history/{promptHistoryId}",
        "definition": {
          "entityName": "PromptHistory",
          "schema": {
            "$ref": "#/backend/entities/PromptHistory"
          },
          "description": "Stores the history of prompts entered by the user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "promptHistoryId",
              "description": "The unique identifier for the prompt history entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/plugins/{pluginId}",
        "definition": {
          "entityName": "Plugin",
          "schema": {
            "$ref": "#/backend/entities/Plugin"
          },
          "description": "Stores plugins installed by a user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "pluginId",
              "description": "The unique identifier for the plugin."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "adminRole",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Indicates admin privileges for a user.  Existence of a document grants admin access.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to be secure, scalable, and easily debuggable, adhering to the core principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters). It utilizes denormalization strategies to avoid hierarchical authorization dependencies and supports robust list operations through structural segregation and membership models.\n\n1.  **Authorization Independence:**\n\n    *   All authorization data is denormalized to avoid `get()` calls in security rules. For instance, if access to chat messages depends on user roles, user role information is included directly within the chat message document.\n2.  **Clarity of Intent:**\n\n    *   The structure explicitly defines access patterns. User-owned data is stored under `/users/{userId}`, and collaborative data uses membership maps.\n3.  **DBAC (Database-Based Access Control):**\n\n    *   User roles are stored directly in the database, specifically using the `/roles_admin/{userId}` collection.  This avoids the need for custom claims, simplifying the authentication process.\n4.  **QAPs (Rules are not Filters):**\n\n    *   Collections are segregated based on access requirements. Private user data is stored separately from collaborative data, enabling efficient and secure `list` operations.\n\n**Denormalization Strategy:**\n\n*   For entities nested under a user, such as chat messages or learning paths, the `userId` is denormalized into each document. This ensures that authorization rules can be applied directly at the document level without needing to traverse up the hierarchy.\n*   For collaborative entities, such as shared learning modules, a `members` map is used within the document. This map explicitly lists the users who have access and their respective roles, making access control straightforward and auditable.\n\n**Structural Segregation:**\n\n*   User-specific data (e.g., settings, prompt history) is stored under the `/users/{userId}` path to ensure that only the user has access.\n*   Global roles are stored in dedicated collections like `/roles_admin`, making it easy to check for admin privileges without complex rule logic.\n\n**Access Modeling:**\n\n*   **Private Data:** User settings and prompt history are stored using path-based ownership (`/users/{userId}/settings/{settingId}`, `/users/{userId}/prompt_history/{promptHistoryId}`).\n*   **Collaborative Data:** If collaborative features were to be added in the future (e.g., shared learning paths), a membership map (`members: {uid1: \"role\", uid2: \"role\"}`) would be used to manage access.\n*   **Global Roles:** The existence of a document in `/roles_admin/{uid}` indicates admin privileges.\n\nThis structure provides a clear and maintainable approach to managing data and access control within the CODEEX AI application."
  }
}