{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the CODEEX AI application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "googleId": {
          "type": "string",
          "description": "User ID from Google authentication, if the user signed up with Google."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        },
        "lastLogin": {
          "type": "string",
          "description": "Timestamp indicating the last time the user logged in.",
          "format": "date-time"
        },
        "profilePicture": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "voicePersona": {
          "type": "string",
          "description": "The voice persona selected by the user (e.g., Codeex Whisper, Jarvis Echo, Narrator Owl)."
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatMessage",
      "type": "object",
      "description": "Represents a single message within a conversation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the chat message."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N ChatMessage)"
        },
        "conversationId": {
          "type": "string",
          "description": "Reference to Conversation. (Relationship: Conversation 1:N ChatMessage)"
        },
        "sender": {
          "type": "string",
          "description": "Indicates who sent the message (e.g., 'user', 'codeex')."
        },
        "messageText": {
          "type": "string",
          "description": "The actual text content of the message."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp indicating when the message was sent.",
          "format": "date-time"
        },
        "helpfulRating": {
          "type": "number",
          "description": "Rating given to the response to indicate if it was helpful or not, likely from 1-5.",
          "format": "integer"
        }
      },
      "required": [
        "id",
        "userId",
        "conversationId",
        "sender",
        "messageText",
        "timestamp"
      ]
    },
    "Conversation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Conversation",
      "type": "object",
      "description": "Represents a single conversation between the user and Codeex AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the conversation."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Conversation)"
        },
        "startTime": {
          "type": "string",
          "description": "Timestamp indicating when the conversation started.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "Timestamp indicating when the conversation ended. Can be null if the conversation is still active."
        },
        "topic": {
          "type": "string",
          "description": "The main topic or subject of the conversation. Can be automatically determined or user-defined."
        },
        "tone": {
          "type": "string",
          "description": "The selected tone for the conversation (playful, professional, poetic, etc.)."
        }
      },
      "required": [
        "id",
        "userId",
        "startTime"
      ]
    },
    "LearningPath": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LearningPath",
      "type": "object",
      "description": "Represents a personalized learning path created for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the learning path."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N LearningPath)"
        },
        "name": {
          "type": "string",
          "description": "Name of the learning path."
        },
        "description": {
          "type": "string",
          "description": "Description of the learning path."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the learning path was created.",
          "format": "date-time"
        },
        "moduleIds": {
          "type": "array",
          "description": "References to LearningModules. (Relationship: LearningPath 1:N LearningModule)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "createdAt"
      ]
    },
    "LearningModule": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LearningModule",
      "type": "object",
      "description": "Represents a single module within a learning path.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the learning module."
        },
        "learningPathId": {
          "type": "string",
          "description": "Reference to LearningPath. (Relationship: LearningPath 1:N LearningModule)"
        },
        "name": {
          "type": "string",
          "description": "Name of the learning module."
        },
        "content": {
          "type": "string",
          "description": "The content of the learning module (e.g., text, links, videos)."
        },
        "order": {
          "type": "number",
          "description": "The order of this module within the learning path.",
          "format": "integer"
        },
        "isCompleted": {
          "type": "boolean",
          "description": "Indicates whether the user has completed this module."
        }
      },
      "required": [
        "id",
        "learningPathId",
        "name",
        "content",
        "order"
      ]
    },
    "PromptHistory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PromptHistory",
      "type": "object",
      "description": "Represents a historical record of prompts entered by the user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the prompt history entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N PromptHistory)"
        },
        "promptText": {
          "type": "string",
          "description": "The actual text of the prompt entered by the user."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp indicating when the prompt was entered.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "promptText",
        "timestamp"
      ]
    },
    "Plugin": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Plugin",
      "type": "object",
      "description": "Represents an installed plugin or integration.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the plugin."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Plugin)"
        },
        "name": {
          "type": "string",
          "description": "Name of the plugin (e.g., Notion, GitHub, Obsidian)."
        },
        "description": {
          "type": "string",
          "description": "Description of the plugin."
        },
        "settings": {
          "type": "string",
          "description": "JSON string containing plugin-specific settings."
        },
        "isEnabled": {
          "type": "boolean",
          "description": "Indicates whether the plugin is currently enabled."
        }
      },
      "required": [
        "id",
        "userId",
        "name"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile data. The 'userId' parameter is the Firebase Authentication UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Authentication UID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/conversations/{conversationId}",
        "definition": {
          "entityName": "Conversation",
          "schema": {
            "$ref": "#/backend/entities/Conversation"
          },
          "description": "Stores conversations for a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Authentication UID of the user."
            },
            {
              "name": "conversationId",
              "description": "The unique identifier for the conversation."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/conversations/{conversationId}/messages/{messageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores chat messages for a specific conversation.  Parent 'conversationId' and grandparent 'userId' enforce ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Authentication UID of the user."
            },
            {
              "name": "conversationId",
              "description": "The unique identifier for the conversation."
            },
            {
              "name": "messageId",
              "description": "The unique identifier for the chat message."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/learningPaths/{learningPathId}",
        "definition": {
          "entityName": "LearningPath",
          "schema": {
            "$ref": "#/backend/entities/LearningPath"
          },
          "description": "Stores learning paths created by a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Authentication UID of the user."
            },
            {
              "name": "learningPathId",
              "description": "The unique identifier for the learning path."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/learningPaths/{learningPathId}/modules/{learningModuleId}",
        "definition": {
          "entityName": "LearningModule",
          "schema": {
            "$ref": "#/backend/entities/LearningModule"
          },
          "description": "Stores learning modules within a specific learning path.  Parent 'learningPathId' and grandparent 'userId' enforce ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Authentication UID of the user."
            },
            {
              "name": "learningPathId",
              "description": "The unique identifier for the learning path."
            },
            {
              "name": "learningModuleId",
              "description": "The unique identifier for the learning module."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/promptHistory/{promptHistoryId}",
        "definition": {
          "entityName": "PromptHistory",
          "schema": {
            "$ref": "#/backend/entities/PromptHistory"
          },
          "description": "Stores the history of prompts entered by a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Authentication UID of the user."
            },
            {
              "name": "promptHistoryId",
              "description": "The unique identifier for the prompt history entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/plugins/{pluginId}",
        "definition": {
          "entityName": "Plugin",
          "schema": {
            "$ref": "#/backend/entities/Plugin"
          },
          "description": "Stores plugins installed by a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Authentication UID of the user."
            },
            {
              "name": "pluginId",
              "description": "The unique identifier for the plugin."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to optimize for security, scalability, and ease of querying, adhering to the principle of Authorization Independence by denormalizing authorization data where necessary.\n\n**Authorization Independence:**\n*   User-owned data (Conversations, ChatMessages, LearningPaths, LearningModules, PromptHistory, Plugins) is stored under the `/users/{userId}` path. This inherently enforces ownership and avoids the need for complex `get()` calls in security rules to check ownership.  No denormalization is required because user ID is already present on the object.\n\n**Structural Segregation:**\n*   All data for a user is located under the `/users/{userId}` collection, which clearly delineates data access based on the authenticated user's ID. This simplifies security rules by ensuring that all documents within a given subcollection share the same access control requirements.\n\n**Access Modeling:**\n*   Path-based ownership (`/users/{userId}/...`) is used for all user-specific data, as described above. This ensures that only the authenticated user can access their own data.\n\n**QAPs (Rules are not Filters):**\n*   List operations are secured by path-based ownership, allowing simple rules that permit listing only documents under the authenticated user's `/users/{userId}` path."
  }
}
